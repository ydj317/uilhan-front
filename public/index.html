<!DOCTYPE html>
<html lang="">
  <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=1920">
      <meta name="naver-site-verification" content="627835433d27d5e889c6ce78e3d66dcd43df26bc" />
      <link rel="icon" href="<%= BASE_URL %>favicon.png">

<!--    <title><%= htmlWebpackPlugin.options.title %></title>-->
      <title>유일</title>
      <meta name="description" content="유일에만 있는 유일한 기능!">
      <meta property="og:type" content="website">
      <meta property="og:title" content="유일">
      <meta property="og:description" content="유일에만 있는 유일한 기능!">
      <meta property="og:image" content="https://sell.uilhan.co.kr/favicon-share.png">
      <meta property="og:url" content="https://sell.uilhan.co.kr">
      <meta name="twitter:card" content="summary">
      <meta name="twitter:title" content="유일">
      <meta name="twitter:description" content="유일에만 있는 유일한 기능!">
      <meta name="twitter:image" content="https://sell.uilhan.co.kr/favicon-share.png">
      <meta name="twitter:domain" content="유일">
<!--    <script>-->
<!--      (function(){var w=window;if(w.ChannelIO){return w.console.error("ChannelIO script included twice.");}var ch=function(){ch.c(arguments);};ch.q=[];ch.c=function(args){ch.q.push(args);};w.ChannelIO=ch;function l(){if(w.ChannelIOInitialized){return;}w.ChannelIOInitialized=true;var s=document.createElement("script");s.type="text/javascript";s.async=true;s.src="https://cdn.channel.io/plugin/ch-plugin-web.js";var x=document.getElementsByTagName("script")[0];if(x.parentNode){x.parentNode.insertBefore(s,x);}}if(document.readyState==="complete"){l();}else{w.addEventListener("DOMContentLoaded",l);w.addEventListener("load",l);}})();-->

<!--      ChannelIO('boot', {-->
<!--          "pluginKey": "33974dfe-4ab5-4a61-8d67-748faed23416",-->
<!--      });-->
<!--    </script>-->
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

    <!-- 결제 호출 JS Start -->
    <!-- 운영 -->
    <script src="https://spay.kcp.co.kr/plugin/kcp_spay_hub.js"></script>
    <!-- 개발 -->
<!--    <script src="https://testspay.kcp.co.kr/plugin/kcp_spay_hub.js"></script>-->
    <!-- 결제 호출 JS End -->

  </head>
  <body>
    <noscript>
      <strong>We're sorry but <%= htmlWebpackPlugin.options.title %> doesn't work properly without JavaScript enabled. Please enable it to continue.</strong>
    </noscript>
    <div id="app"></div>
    <!-- built files will be auto injected -->
  <script type="text/javascript">
      const API_URL = '<%= VUE_APP_API_URL %>';
      const token = getCookie('token');
      /* 인증완료시 재귀 함수 认证后的回调函数  */
      function m_Completepayment(FormOrJson, closeEvent )
      {
          var frm = document.order_info;
          GetField( frm, FormOrJson );
        if( frm.res_cd.value == "0000" )
        {
          /*
              가맹점 리턴값 처리 영역
          */
          var orderIds = frm.ordr_idxx.value.split(',');
          var url = '/api/user/order/update/payed?XDEBUG_SESSION_START=PHPSTORM';
          var param = {
            orderIds,
            good_mny:frm.good_mny.value,
            tran_cd:frm.tran_cd.value,
            enc_data:frm.enc_data.value,
            enc_info:frm.enc_info.value,
            ordr_chk:frm.ordr_chk.value,
              pay_method:frm.pay_method.value,
          };
          updateOrderStatus(url,param,(res)=>{
            if (res){
              setCookie("planData",true)
                alert('결제가 완료되었습니다.')
                closeEvent()
              location.href = '/user/mypage';
            } else {
              alert('결제가 실패하였습니다.')
                closeEvent()
                location.href = '/user/servicesPay';
            }
          }#
        }
        else
        {
          // alert( "[" + frm.res_cd.value + "] " + frm.res_msg.value );
          if(frm.res_cd.value == '3001'){
            closeEvent();
            var orderIds = frm.ordr_idxx.value.split(',');
            var url = '/api/user/order/update/cancelPayment';
            var param = { orderIds };
            updateOrderStatus(url,param,(res)=>{
            });
          }
        }
      }
      function updateOrderStatus(url,param,callback){
        $.ajax({
          url: API_URL + url,
          type: 'POST',  // 请求方法
          contentType: 'application/json',  // 请求头，指定发送的是 JSON 数据
          data: JSON.stringify(param),  // 请求体，序列化为 JSON 格式
          headers: { 'token': token},
          success: function (res) {
            if (res.status !== "2000") {
              alert(res.message);
              return false;
            }
            callback(res.data);
          },
          error: function (xhr, status, error) {  // 失败回调
            console.error('Error response:', xhr.responseText);
          }
        });
      }
      function getCookie(cname)
      {
        var name = cname + "=";
        var ca = document.cookie.split(';');
        for(var i=0; i<ca.length; i++)
        {
          var c = ca[i].trim();
          if (c.indexOf(name)==0) return unescape(c.substring(name.length,c.length));
        }
        return "";
      }

      function setCookie(cname,cvalue,day = 0){
        var d = new Date();
        var expires = '';
        if(day){
          d.setTime(d.getTime()+(day*24*60*60*1000));
          expires = "expires="+d.toGMTString();
        }
        document.cookie = cname+"="+escape(cvalue)+"; "+expires;
      }
  </script>
  </body>
</html>
