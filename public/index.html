<!DOCTYPE html>
<html lang="">
  <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width,initial-scale=1.0">
      <meta name="naver-site-verification" content="627835433d27d5e889c6ce78e3d66dcd43df26bc" />
      <link rel="icon" href="<%= BASE_URL %>favicon.png">

<!--    <title><%= htmlWebpackPlugin.options.title %></title>-->
      <title>유일</title>
      <meta name="description" content="유일에만 있는 유일한 기능!">
      <meta property="og:type" content="website">
      <meta property="og:title" content="유일">
      <meta property="og:description" content="유일에만 있는 유일한 기능!">
      <meta property="og:image" content="https://sell.uilhan.co.kr/favicon.png">
      <meta property="og:url" content="https://sell.uilhan.co.kr">
      <meta name="twitter:card" content="summary">
      <meta name="twitter:title" content="유일">
      <meta name="twitter:description" content="유일에만 있는 유일한 기능!">
      <meta name="twitter:image" content="https://sell.uilhan.co.kr/favicon.png">
      <meta name="twitter:domain" content="유일">
<!--    <script>-->
<!--      (function(){var w=window;if(w.ChannelIO){return w.console.error("ChannelIO script included twice.");}var ch=function(){ch.c(arguments);};ch.q=[];ch.c=function(args){ch.q.push(args);};w.ChannelIO=ch;function l(){if(w.ChannelIOInitialized){return;}w.ChannelIOInitialized=true;var s=document.createElement("script");s.type="text/javascript";s.async=true;s.src="https://cdn.channel.io/plugin/ch-plugin-web.js";var x=document.getElementsByTagName("script")[0];if(x.parentNode){x.parentNode.insertBefore(s,x);}}if(document.readyState==="complete"){l();}else{w.addEventListener("DOMContentLoaded",l);w.addEventListener("load",l);}})();-->

<!--      ChannelIO('boot', {-->
<!--          "pluginKey": "33974dfe-4ab5-4a61-8d67-748faed23416",-->
<!--      });-->
<!--    </script>-->
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

    <!-- 결제 호출 JS Start -->
    <!-- 운영 -->
    <script src="https://spay.kcp.co.kr/plugin/kcp_spay_hub.js"></script>
    <!-- 개발 -->
<!--    <script src="https://testspay.kcp.co.kr/plugin/kcp_spay_hub.js"></script>-->
    <!-- 결제 호출 JS End -->

  </head>
  <body>
    <noscript>
      <strong>We're sorry but <%= htmlWebpackPlugin.options.title %> doesn't work properly without JavaScript enabled. Please enable it to continue.</strong>
    </noscript>
    <div id="app"></div>
    <!-- built files will be auto injected -->
  <script type="text/javascript">
      const API_URL = '<%= VUE_APP_API_URL %>';
      const token = getCookie('token');
      /* 인증완료시 재귀 함수 认证后的回调函数  */
      function m_Completepayment(FormOrJson, closeEvent )
      {
          var frm = document.order_info;

          GetField( frm, FormOrJson );
        if( frm.res_cd.value == "0000" )
        {
          // alert("결제 승인 요청 전,\n\n반드시 결제창에서 고객님이 결제 인증 완료 후\n\n리턴 받은 ordr_chk 와 업체 측 주문정보를\n\n다시 한번 검증 후 결제 승인 요청하시기 바랍니다."); //업체 연동 시 필수 확인 사항.
          /*
              가맹점 리턴값 처리 영역
          */
          var orderIds = frm.ordr_idxx.value.split(',');
          var url = '/api/user/order/update/payed';
          var param = { orderIds, amount:frm.good_mny.value };
          updateOrderStatus(url,param,(res)=>{
            if (res){
              frm.submit();
              location.href = '/user/mypage';
            }
          });
        }
        else
        {
          // alert( "[" + frm.res_cd.value + "] " + frm.res_msg.value );
          if(frm.res_cd.value == '3001'){
            var orderIds = frm.ordr_idxx.value.split(',');
            var url = '/api/user/order/update/cancelPayment';
            var param = { orderIds };
            updateOrderStatus(url,param,(res)=>{
              closeEvent();
            });
          }

        }
      }
      function updateOrderStatus(url,param,callback){
        $.ajax({
          url: API_URL + url,
          type: 'POST',  // 请求方法
          contentType: 'application/json',  // 请求头，指定发送的是 JSON 数据
          data: JSON.stringify(param),  // 请求体，序列化为 JSON 格式
          headers: { 'token': token},
          success: function (res) {
            if (res.status !== "2000") {
              alert(res.message);
              return false;
            }
            callback(res.data);
          },
          error: function (xhr, status, error) {  // 失败回调
            console.error('Error response:', xhr.responseText);
          }
        });
      }
      function getCookie(cname)
      {
        var name = cname + "=";
        var ca = document.cookie.split(';');
        for(var i=0; i<ca.length; i++)
        {
          var c = ca[i].trim();
          if (c.indexOf(name)==0) return unescape(c.substring(name.length,c.length));
        }
        return "";
      }
  </script>
  </body>
</html>
